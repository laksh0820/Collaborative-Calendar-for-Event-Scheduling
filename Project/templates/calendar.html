{% extends 'base.html' %}

{% block extra_header %}
<!-- FullCalender JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>

<link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>
<script src='https://cdn.jsdelivr.net/npm/@fullcalendar/bootstrap5@6.1.15/index.global.min.js'></script>

<link rel="stylesheet" href="{{ url_for('static',filename='css/calendar.css') }}" />
{% endblock %}

{% block content %}
<!-- In your template -->
<meta name="user-id" content="{{ current_user.user_id }}">
<meta name="user-name" content="{{ current_user.name }}">
<meta name="user-email" content="{{ current_user.email }}">

<!-- Bootstrap Modal -->
<div class="p-5">
	<h2 class="mb-4">Calendar</h2>
	<div class="card">
		<div class="card-body p-0">
			<div id="calendar-controls"
				style="margin-bottom: 10px; width: 50%; position: relative;left: 50%;transform: translateX(-50%);">
				<select id="group-select" class="form-control">
					<option value="1" data-permission="Admin">Dashboard</option>
					{% for group in groups %}
					<option id="group-select-option-{{ group.group_id }}" value="{{ group.group_id }}" data-permission="{{ group.permission }}">{{ group.group_name }}</option>
					{% endfor %}
				</select>
			</div>
			<div id="calendar"></div>
		</div>
	</div>
</div>

<div id='script-warning'>
	Error getting data from <code>/data</code> endpoint.
</div>

<div id='loading'>loading...</div>

<!-- calendar modal -->
<div id="modal-view-event" class="modal modal-top fade calendar-modal">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-body">
				<h4 class="modal-title"><span class="event-icon"></span><span class="event-title"></span></h4>
				<div class="description" style="display: flex;">
					<span className="icon">ðŸ“…</span>
					<p class="event-body" style="margin-left: 5px;"></p>
				</div>
				<!-- Participants Section -->
				<div id="participants-section" class="mt-2">
					<div class="participantHeader" style="display: flex;">
						<span className="icon">ðŸ‘¥</span>
						<h5 style="margin-left: 5px;">Participants</h5>
					</div>
					<div id="participants-list" class="flex-wrap mt-1"></div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<style>
	.event-body {
		font-size: 0.875rem;
		color: #212529;
	}

	.no-description {
		color: #6b7280;
	}

	#participants-list {
		display: flex;
		flex-direction: column;
		padding-left: 1rem;
	}

	.participant {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 0.5rem;
		border-radius: 0.5rem;
		transition: background-color 0.2s;
	}

	.participant:hover {
		background-color: #f8f9fa;
	}

	.avatar {
		width: 2.5rem;
		height: 2.5rem;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		color: white;
		font-weight: 600;
		font-size: 0.875rem;
		flex-shrink: 0;
	}

	.participant-info {
		display: flex;
		flex-direction: column;
	}

	.participant-info .name {
		margin: 0;
		font-weight: 500;
		font-size: 0.875rem;
		color: #212529;
	}

	.participant-info .email {
		margin: 0;
		font-size: 0.75rem;
		color: #6b7280;
	}

	.text-muted {
		padding-left: 0.7rem;
		color: #6b7280 !important;
		font-size: 14px;
	}
</style>

<div id="modal-view-event-add" class="modal modal-top fade calendar-modal">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<form id="add-event">
				<div class="modal-body">
					<h4>Add Event Detail</h4>
					<div class="form-group">
						<label>Event name</label>
						<input type="text" class="form-control" name="ename" id="eventTitle">
						<div class="invalid-feedback"></div>
					</div>
					<div class="form-group">
						<label>Start Date</label>
						<input type="datetime-local" class="form-control" name="edate" id="eventStart" required>
						<div class="invalid-feedback"></div>
					</div>
					<div class="form-group">
						<label>End Date</label>
						<input type="datetime-local" class="form-control" name="edate" id="eventEnd" required>
						<div class="invalid-feedback"></div>
					</div>
					<div class="form-group">
						<label>Event Description</label>
						<textarea class="form-control" name="edesc" id="eventDescription" rows="6"
							style="min-height: 100px; resize: vertical;"></textarea>
					</div>
					<div class="form-group" id="participants">
						<label>Participants</label>
						<div class="input-group mb-2">
							<select class="form-control" id="participantSelect" placeholder="Enter email">
								<option></option>
							</select>
							<button class="btn btn-light" type="button" id="addParticipantBtn"
								style="color:rgb(30, 18, 82);">
								<i class="bi bi-people-fill"></i> Select
							</button>
						</div>
						<div id="eventParticipantsList" class="d-flex flex-wrap gap-2"></div>
						<div class="invalid-feedback"></div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-primary" id="saveEvent">Save</button>
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<script src="{{ url_for ('static',filename='js/calendar.js') }}"></script>
{% endblock %}