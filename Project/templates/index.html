<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8' />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
	<!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<!-- Bootstrap JS -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<script>

		$(document).ready(function() {
			// To create a current date object
			const currentDate = new Date();

			$('#calendar').fullCalendar({
				header: {
					left: 'prev,next today',
					center: 'title',
					right: 'month,agendaWeek,agendaDay'
				},
				defaultDate: `${currentDate.getFullYear()}-${currentDate.getMonth() + 1}-${currentDate.getDate()}`,
				eventLimit: true, // allow "more" link when too many events
				events: '/data',
				selectable: true, // allow select option to create new events
				select: function(start, end) {
					// Open the modal when a time range is selected
					$('#eventModal').modal('show');

					// Set the start and end times in the form
					$('#eventStart').val(start.format('YYYY-MM-DD'));
					$('#eventEnd').val(end.format('YYYY-MM-DD'));
				},
				loading: function(bool) {
					$('#loading').toggle(bool);
				}
			});

			$('#saveEvent').on('click', function(event) {
				event.preventDefault();	
				var eventTitle = $('#eventTitle').val();
				var eventStart = $('#eventStart').val();
				var eventEnd = $('#eventEnd').val();
		
				$.ajax({
					url: '/add_event',
					type: 'POST',
					contentType: 'application/json',
					data: JSON.stringify({
						title: eventTitle,
						start: eventStart,
						end: eventEnd
					}),
					success: function(response) {
						$('#eventModal').modal('hide');
						$('#calendar').fullCalendar('renderEvent',{
							title: eventTitle,
							start: eventStart,
							end: eventEnd
						},true);
						alert("Event added successfully");
					},
					error: function(){
						alert('There was an error while adding the event.');
					}
				});
			});
			
		});

	</script>
	<style>

		body {
			margin: 0;
			padding: 0;
			font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
			font-size: 14px;
		}

		#script-warning {
			display: none;
			background: #eee;
			border-bottom: 1px solid #ddd;
			padding: 0 10px;
			line-height: 40px;
			text-align: center;
			font-weight: bold;
			font-size: 12px;
			color: red;
		}

		#loading {
			display: none;
			position: absolute;
			top: 10px;
			right: 10px;
		}

		#calendar {
			max-width: 900px;
			margin: 40px auto;
			padding: 0 10px;
		}

	</style>
</head>
<body>

	<div class="container mt-4">
		<div id="calendar"></div>
	</div>

	<div id='script-warning'>
		Error getting data from <code>/data</code> endpoint.
	</div>

	<div id='loading'>loading...</div>

	<!-- Bootstrap Modal -->
	<div class="modal fade" id="eventModal" tabindex="-1" role="dialog" aria-labelledby="eventModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="eventModalLabel">Add Event</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="eventForm">
						<div class="form-group">
							<label for="eventTitle">Event Title</label>
							<input type="text" class="form-control" id="eventTitle" required>
						</div>
						<div class="form-group">
							<label for="eventStart">Start Time</label>
							<input type="datetime-local" class="form-control" id="eventStart" required>
						</div>
						<div class="form-group">
							<label for="eventEnd">End Time</label>
							<input type="datetime-local" class="form-control" id="eventEnd" required>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary" id="saveEvent">Save Event</button>
				</div>
			</div>
		</div>
	</div>

</body>
</html>